<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/vault-management.css">
    <link rel="stylesheet" href="/css/loader.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="/images/logo/logo_100x100_transparent.png" type="image/x-icon">
    <title>HiveWise - Vault Management</title>
</head>

<body>

    <div class="loader" id="loader">
        <ul class="hexagon-container">
            <li class="hexagon hex_1"></li>
            <li class="hexagon hex_2"></li>
            <li class="hexagon hex_3"></li>
            <li class="hexagon hex_4"></li>
            <li class="hexagon hex_5"></li>
            <li class="hexagon hex_6"></li>
            <li class="hexagon hex_7"></li>
        </ul>
    </div>

    <div id="main-content" class="fade-in main-content">

        <aside class="sidebar" id="side-bar">
            <a class="logo" href="/">
                <img src="/images/logo/logo_100x100_transparent.png" height="40" width="40" alt="logo">
                <span class="logo-text">HIVEWISE</span>
            </a>
            <div class="sidebar-links-container">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; gap: 55px; margin-bottom: 20px;">
                    <div class="text-header-sidebar">Vault Management</div>
                    <div class="sidebar-toggle" data-tooltip="Collapse">
                        <svg id="icon-collapse" class="w-6 h-6 text-gray-800 dark:text-white"
                            xmlns="http://www.w3.org/2000/svg" width="29" height="29" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                                d="M8.99994 10 7 11.9999l1.99994 2M12 5v14M5 4h14c.5523 0 1 .44772 1 1v14c0 .5523-.4477 1-1 1H5c-.55228 0-1-.4477-1-1V5c0-.55228.44772-1 1-1Z" />
                        </svg>
                        <svg id="icon-expand" class="w-6 h-6 text-gray-800 dark:text-white hidden"
                            xmlns="http://www.w3.org/2000/svg" width="29" height="29" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                                d="m7 10 1.99994 1.9999-1.99994 2M12 5v14M5 4h14c.5523 0 1 .44772 1 1v14c0 .5523-.4477 1-1 1H5c-.55228 0-1-.4477-1-1V5c0-.55228.44772-1 1-1Z" />
                        </svg>
                    </div>

                </div>
                <a class="sidebar-link sidebar-link-active" href="#" id="my-vaults-link">
                    <div
                        style="width: 20px; height: 20px;  color: rgb(50, 48, 44); fill: rgb(50, 48, 44); flex-shrink: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-safe"
                            viewBox="0 0 16 16" style="width: 100%; height: 100%; display: block;  flex-shrink: 0;">
                            <path
                                d="M1 1.5A1.5 1.5 0 0 1 2.5 0h12A1.5 1.5 0 0 1 16 1.5v13a1.5 1.5 0 0 1-1.5 1.5h-12A1.5 1.5 0 0 1 1 14.5V13H.5a.5.5 0 0 1 0-1H1V8.5H.5a.5.5 0 0 1 0-1H1V4H.5a.5.5 0 0 1 0-1H1zM2.5 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 .5.5h12a.5.5 0 0 0 .5-.5v-13a.5.5 0 0 0-.5-.5z" />
                            <path
                                d="M13.5 6a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 1 .5-.5M4.828 4.464a.5.5 0 0 1 .708 0l1.09 1.09a3 3 0 0 1 3.476 0l1.09-1.09a.5.5 0 1 1 .707.708l-1.09 1.09c.74 1.037.74 2.44 0 3.476l1.09 1.09a.5.5 0 1 1-.707.708l-1.09-1.09a3 3 0 0 1-3.476 0l-1.09 1.09a.5.5 0 1 1-.708-.708l1.09-1.09a3 3 0 0 1 0-3.476l-1.09-1.09a.5.5 0 0 1 0-.708M6.95 6.586a2 2 0 1 0 2.828 2.828A2 2 0 0 0 6.95 6.586" />
                        </svg>
                    </div>
                    <span class="">My vaults</span>
                </a>

                <a class="sidebar-link" href="#" id="trash-link">
                    <div
                        style="width: 20px; height: 20px;  color: rgb(50, 48, 44); fill: rgb(50, 48, 44); flex-shrink: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-trash"
                            viewBox="0 0 16 16" style="width: 100%; height: 100%; display: block;  flex-shrink: 0;">
                            <path
                                d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
                            <path fill-rule="evenodd"
                                d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
                        </svg>
                    </div>
                    <span>Trash</span>
                </a>


                <!-- <a class="sidebar-link " id="open-another-modal">
                    <div
                        style="width: 20px; height: 20px;  color: rgb(50, 48, 44); fill: rgb(50, 48, 44); flex-shrink: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-gear"
                            viewBox="0 0 16 16" style="width: 100%; height: 100%; display: block;  flex-shrink: 0;">
                            <path
                                d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                            <path
                                d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
                        </svg>
                    </div>
                    <span>Settings</span>
                </a> -->
            </div>
        </aside>

        <div class="main-section">
            <div class="navbar">
                <!-- Status Filter Tabs in Navbar -->
                <div class="navbar-filter-tabs"
                    style="display: flex; align-items: center; gap: 10px; margin-left: 20px;">
                    <!-- <span style="font-size: 14px; font-weight: 500; color: #6b7280; margin-right: 10px;">Filter:</span> -->

                    <a class="navbar-filter-link navbar-filter-active" href="#" id="filter-all-link" data-filter="all">
                        <span>All</span>
                        <span class="navbar-filter-count" id="count-all" th:text="${totalVaults}">0</span>
                    </a>

                    <a class="navbar-filter-link" href="#" id="filter-active-link" data-filter="active">
                        <span>Active</span>
                        <span class="navbar-filter-count" id="count-active" th:text="${activeVaults}">0</span>
                    </a>

                    <a class="navbar-filter-link" href="#" id="filter-inactive-link" data-filter="inactive">
                        <span>Inactive</span>
                        <span class="navbar-filter-count" id="count-inactive" th:text="${inactiveVaults}">0</span>
                    </a>
                </div>

                <div class="navbar-right"
                    style="margin-left: auto; width: 100%; display: flex; justify-content: flex-end; align-items: center; gap: 15px;">
                    <div class="search-container">
                        <img src="/images/icon/Search_light.svg" alt="search icon" class="search-icon">
                        <input type="text" class="search-bar" id="vault-search-input" placeholder="Search vaults...">
                        <div class="clear-search" id="clear-search-btn" title="Clear search">×</div>
                        <!-- Search Results Dropdown -->
                        <div class="search-results-dropdown" id="search-results-dropdown">
                            <div class="search-results-content" id="search-results-content">
                                <!-- Search results will be populated here -->
                            </div>
                        </div>
                    </div>
                    <a class="add-vault-btn">
                        <img style="margin-left: -10px;" src="/images/icon/Add_round_duotone_line.svg" alt="">
                        <span class="label-add-vault-btn">Add vault</span>
                    </a>
                    <div class="notification-btn" style="margin-right: -15px; display: none;">
                        <img src="/images/icon/Notification.svg" alt="notification icon">
                    </div>
                    <div style="margin-right: -1px;" class="vertical-divider"></div>
                    <div class="user" id="user-dropdown-toggle">
                        <div class="profile-picture">
                            <img th:src="${user.avatar != null and !#strings.isEmpty(user.avatar) ? user.avatar : '/images/avatar/df_avatar.jpg'}"
                                alt="profile picture">
                        </div>
                        <span class="profile-name" th:text="${user.username}">User</span>
                        <img src="/images/icon/Expand_down.svg" alt="expand icon">

                        <div class="dropdown-menu" id="user-dropdown">
                            <a id="open-another-modal"
                                style="display: flex; flex-direction: row; gap: 10px; align-items: center;">
                                <svg aria-hidden="true" role="graphics-symbol" viewBox="0 0 20 20" class="gear"
                                    style="width: 22px; height: 22px; display: block; fill: rgba(71, 70, 68, 0.6); flex-shrink: 0;">
                                    <path
                                        d="M7.29 10c0 1.5 1.22 2.71 2.71 2.71 1.5 0 2.71-1.21 2.71-2.71S11.5 7.29 10 7.29 7.29 8.5 7.29 10m1.25 0c0-.81.66-1.46 1.46-1.46.81 0 1.46.65 1.46 1.46s-.65 1.46-1.46 1.46-1.46-.65-1.46-1.46">
                                    </path>
                                    <path
                                        d="M8.49 17.64q.75.15 1.53.15v-.01c.47 0 .94-.04 1.41-.13.26-.05.46-.25.5-.51l.26-1.53.15-.06 1.28.91c.21.14.49.14.71 0 .41-.28.8-.61 1.18-.98.33-.33.63-.7.9-1.09.15-.21.15-.5 0-.71l-.9-1.27.06-.15 1.55-.27c.26-.05.46-.25.51-.5a7.8 7.8 0 0 0 .02-2.94.62.62 0 0 0-.51-.5l-1.53-.26-.06-.15.91-1.28c.14-.21.14-.49 0-.71a7.9 7.9 0 0 0-2.07-2.08.62.62 0 0 0-.71 0l-1.27.9-.15-.06-.27-1.55a.64.64 0 0 0-.5-.51c-.5-.1-1-.15-1.53-.15-.47 0-.95.04-1.41.13-.26.05-.46.25-.5.51l-.26 1.53-.15.06-1.28-.91a.65.65 0 0 0-.71 0 7.9 7.9 0 0 0-2.08 2.07c-.15.21-.15.5 0 .71l.9 1.27-.06.15-1.55.27c-.26.05-.46.25-.51.5-.1.5-.15 1-.15 1.53 0 .47.04.95.13 1.41.05.26.25.46.51.5l1.53.26.06.15-.91 1.28c-.14.21-.15.49 0 .71.29.42.61.81.98 1.18.34.34.7.65 1.09.91.21.15.5.15.71 0l1.27-.9.15.06.27 1.55c.05.26.25.46.5.51m2.29-1.15c-.53.07-1.09.07-1.63 0l-.25-1.47a.62.62 0 0 0-.42-.49 6 6 0 0 1-.68-.28.63.63 0 0 0-.65.04l-1.2.85a6.8 6.8 0 0 1-1.14-1.16l.86-1.21c.13-.19.15-.43.05-.64-.11-.22-.21-.45-.28-.68a.62.62 0 0 0-.49-.43l-1.45-.25a6.7 6.7 0 0 1 0-1.63l1.47-.25c.23-.04.42-.2.49-.42.07-.23.17-.46.28-.68.11-.21.09-.46-.04-.65l-.85-1.2A6.8 6.8 0 0 1 6.01 4.8l1.21.86c.19.13.43.15.64.05.22-.11.45-.21.68-.28s.39-.26.43-.49l.25-1.45c.53-.07 1.09-.07 1.63 0l.25 1.47c.04.23.2.42.42.49.23.07.46.17.68.28.21.11.46.09.65-.04l1.2-.85A6.8 6.8 0 0 1 15.19 6l-.86 1.21c-.13.19-.15.43-.05.64.11.22.21.45.28.68s.26.39.49.43l1.45.25a6.7 6.7 0 0 1 0 1.63l-1.47.25c-.23.04-.42.2-.49.42-.07.23-.17.46-.28.68-.11.21-.09.46.04.65l.85 1.2a6.8 6.8 0 0 1-1.16 1.14l-1.21-.86a.64.64 0 0 0-.64-.05c-.22.11-.45.21-.68.28s-.39.26-.43.49z">
                                    </path>
                                </svg>
                                <span>Profile</span>
                            </a> <a href="/auth/log-out"
                                style="display: flex; flex-direction: row; align-items: center; gap: 8px;">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"
                                    xmlns="http://www.w3.org/2000/svg" data-rtl-flip="" class="icon" aria-hidden="true">
                                    <path
                                        d="M3.50171 12.6663V7.33333C3.50171 6.64424 3.50106 6.08728 3.53784 5.63704C3.57525 5.17925 3.65463 4.77342 3.84644 4.39681L3.96851 4.17806C4.2726 3.68235 4.70919 3.2785 5.23023 3.01302L5.3728 2.94661C5.7091 2.80238 6.06981 2.73717 6.47046 2.70443C6.9207 2.66764 7.47766 2.66829 8.16675 2.66829H9.16675L9.30054 2.68197C9.60367 2.7439 9.83179 3.0119 9.83179 3.33333C9.83179 3.65476 9.60367 3.92277 9.30054 3.9847L9.16675 3.99837H8.16675C7.45571 3.99837 6.96238 3.99926 6.57886 4.0306C6.297 4.05363 6.10737 4.09049 5.96362 4.14193L5.83374 4.19857C5.53148 4.35259 5.27861 4.58671 5.1023 4.87435L5.03198 5.00032C4.95147 5.15833 4.89472 5.36974 4.86401 5.74544C4.83268 6.12896 4.83179 6.6223 4.83179 7.33333V12.6663C4.83179 13.3772 4.8327 13.8707 4.86401 14.2542C4.8947 14.6298 4.95153 14.8414 5.03198 14.9993L5.1023 15.1263C5.27861 15.4137 5.53163 15.6482 5.83374 15.8021L5.96362 15.8577C6.1074 15.9092 6.29691 15.947 6.57886 15.9701C6.96238 16.0014 7.45571 16.0013 8.16675 16.0013H9.16675L9.30054 16.015C9.6036 16.0769 9.83163 16.345 9.83179 16.6663C9.83179 16.9877 9.60363 17.2558 9.30054 17.3177L9.16675 17.3314H8.16675C7.47766 17.3314 6.9207 17.332 6.47046 17.2952C6.06978 17.2625 5.70912 17.1973 5.3728 17.0531L5.23023 16.9867C4.70911 16.7211 4.27261 16.3174 3.96851 15.8216L3.84644 15.6038C3.65447 15.2271 3.57526 14.8206 3.53784 14.3626C3.50107 13.9124 3.50171 13.3553 3.50171 12.6663ZM13.8035 13.804C13.5438 14.0634 13.1226 14.0635 12.863 13.804C12.6033 13.5443 12.6033 13.1223 12.863 12.8626L13.8035 13.804ZM12.863 6.19661C13.0903 5.96939 13.4409 5.94126 13.699 6.11165L13.8035 6.19661L17.1375 9.52962C17.3969 9.78923 17.3968 10.2104 17.1375 10.4701L13.8035 13.804L13.3337 13.3333L12.863 12.8626L15.0603 10.6654H9.16675C8.79959 10.6654 8.50189 10.3674 8.50171 10.0003C8.50171 9.63306 8.79948 9.33529 9.16675 9.33529H15.0613L12.863 7.13704L12.7781 7.03255C12.6077 6.77449 12.6359 6.42386 12.863 6.19661Z">
                                    </path>
                                </svg>
                                <span>Log out</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-frame">
                <div class="content-card-list" id="vault-list-content"
                    th:classappend="${showCardList} ? 'grid' : 'hidden'">

                    <!-- Simple Circle Loading Animation -->
                    <div class="vault-loading" id="vault-loading">
                        <div class="loading-circle"></div>
                    </div>

                    <!-- Original empty state - only when no vaults exist at all -->
                    <div th:if="${#lists.isEmpty(vaults)}" class="empty-vault-list" id="original-empty-state">
                        <div class="empty-vault-box">
                            <svg class="ant-empty-img-simple" width="64" height="41" viewBox="0 0 64 41"
                                xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 16px;">
                                <g transform="translate(0 1)" fill="none" fill-rule="evenodd">
                                    <ellipse class="ant-empty-img-simple-ellipse" cx="32" cy="33" rx="32" ry="7"
                                        fill="#F5F5F7"></ellipse>
                                    <g class="ant-empty-img-simple-g" fill-rule="nonzero">
                                        <path
                                            d="M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"
                                            fill="#aeb8c2"></path>
                                        <path
                                            d="M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z"
                                            class="ant-empty-img-simple-path" fill="#f5f5f7"></path>
                                    </g>
                                </g>
                            </svg>
                            <div class="empty-vault-text">No data</div>
                        </div>
                    </div>

                    <!-- Empty state for filtering - only when vaults exist but none match filter -->
                    <div th:if="${!#lists.isEmpty(vaults)}" id="filter-empty-state" class="empty-vault-list hidden">
                        <div class="empty-vault-box">
                            <svg class="ant-empty-img-simple" width="64" height="41" viewBox="0 0 64 41"
                                xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 16px;">
                                <g transform="translate(0 1)" fill="none" fill-rule="evenodd">
                                    <ellipse class="ant-empty-img-simple-ellipse" cx="32" cy="33" rx="32" ry="7"
                                        fill="#F5F5F7"></ellipse>
                                    <g class="ant-empty-img-simple-g" fill-rule="nonzero">
                                        <path
                                            d="M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"
                                            fill="#aeb8c2"></path>
                                        <path
                                            d="M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z"
                                            class="ant-empty-img-simple-path" fill="#f5f5f7"></path>
                                    </g>
                                </g>
                            </svg>
                            <div class="empty-vault-text">No vaults found for this filter</div>
                        </div>
                    </div>


                    <div th:each="vault : ${myVaults}" class="card-vault"
                        th:data-status="${vault.isActivated} ? 'active' : 'inactive'" th:data-vault-id="${vault.id}"
                        th:classappend="${!vault.isActivated} ? 'vault-inactive' : ''">

                        <div th:if="${!vault.isActivated}" class="inactive-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
                                     background: rgba(0,0,0,0.3); z-index: 10; border-radius: 8px; 
                                     pointer-events: none;">
                        </div>

                        <div class="card-vault-header"
                            style="display: flex; align-items: center; gap: 12px; position: relative; z-index: 2;">
                            <div class="vault-picture">
                                <img th:src="${vault.photoUrl != null and !#strings.isEmpty(vault.photoUrl) ? vault.photoUrl + '?t=' + vault.updatedAt : '/images/vault/vault_df.webp'}"
                                    alt="vault picture" style="object-fit: cover; width: 100%; height: 100%;">
                            </div>
                            <div class="vault-header-info" style="flex: 1; min-width: 0;">
                                <a class="vault-name" th:href="@{'/vault-detail?id=' + ${vault.id} + '&assistant=true'}"
                                    th:text="${vault.name}" style="text-decoration: none;"
                                    th:onclick="${!vault.isActivated} ? 'event.preventDefault(); showToast(\'This vault is inactive and cannot be accessed\', \'warning\');' : ''">Vault</a>

                                <div class="vault-owner"
                                    style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"
                                    th:title="${vault.createdByEmail}">
                                    Vault owner: <span th:text="${vault.createdByEmail}"
                                        style="white-space: nowrap;">Owner</span>
                                </div>
                            </div>

                            <!-- Edit button for active vaults -->
                            <a th:if="${vault.isActivated}" type="submit" class="edit-vault-btn"
                                th:href="@{'/vault-management/edit-vault/general?id=' + ${vault.id}}"
                                style="background: none; border: none; padding: 0; margin: 0; cursor: pointer; position: relative; z-index: 3;">
                                <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true"
                                    xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none"
                                    viewBox="0 0 24 24">
                                    <path stroke="#555555" stroke-linecap="round" stroke-linejoin="round"
                                        stroke-width="1"
                                        d="m14.304 4.844 2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565 6.844-6.844a2.015 2.015 0 0 1 2.852 0Z" />
                                </svg>
                            </a>

                            <!-- Meatball menu for inactive vaults only -->
                            <div th:if="${!vault.isActivated}" class="vault-actions-menu"
                                style="position: relative; z-index: 3;">
                                <button class="meatball-menu-btn" th:data-vault-id="${vault.id}"
                                    style="background: none; border: none; padding: 4px; cursor: pointer; border-radius: 4px;">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="12" cy="5" r="2" fill="#555555" />
                                        <circle cx="12" cy="12" r="2" fill="#555555" />
                                        <circle cx="12" cy="19" r="2" fill="#555555" />
                                    </svg>
                                </button>
                                <div th:id="'vault-menu-' + ${vault.id}" class="vault-menu-dropdown" style="display: none; position: absolute; top: 100%; right: 0; background: white; 
                                           border: 1px solid #e1e5e9; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                                           min-width: 150px; z-index: 1000;">
                                    <button class="vault-menu-item delete-item" th:data-vault-id="${vault.id}"
                                        th:data-vault-name="${vault.name}" style="width: 100%; padding: 12px 16px; border: none; background: none; 
                                               text-align: left; cursor: pointer; display: flex; align-items: center; gap: 8px;
                                               color: #dc3545; font-size: 14px; border-radius: 6px;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                                                stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round" />
                                        </svg>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-divider"></div>
                        <div class="card-vault-body">
                            <div class="vault-info">
                                <img src="/images/icon/Chart_pin_light.svg" alt="icon status">
                                <span>Status:</span>
                                <span th:classappend="${vault.isActivated} ? 'status-active' : 'status-inactive'"
                                    th:text="${vault.isActivated} ? 'Active' : 'Inactive'">Status</span>
                            </div>
                            <div class="vault-info">
                                <img src="/images/icon/Group_duotone_line.svg" alt="icon members">
                                <span>Total members:</span>
                                <span class="number-in-card" th:text="${vaultMemberCounts[vault.id]}">0</span>
                            </div>
                            <div class="vault-info">
                                <img src="/images/icon/Chemistry _light.svg" alt="icon knowledge">
                                <span>Total knowledge articles:</span>
                                <span class="number-in-card" th:text="${vaultKnowledgeCounts[vault.id]}">0</span>
                            </div>
                        </div>
                        <div class="card-divider"></div>
                        <div class="create-date">
                            <img src="/images/icon/Time_duotone_line.svg" alt="icon knowledge">
                            <span>Created on</span>
                            <span
                                th:text="${vault.createdAt == null ? '--' : #temporals.format(vault.createdAt, 'dd/MMM/yy hh:mm a')}">--</span>
                        </div>
                    </div>

                    <!-- Trash Vaults (deleted) -->
                    <div th:each="vault : ${trashVaults}" class="card-vault trash-vault" th:data-status="deleted"
                        th:data-vault-id="${vault.id}" style="position: relative;">

                        <div class="card-vault-header"
                            style="display: flex; align-items: center; gap: 12px; position: relative; z-index: 2;">
                            <div class="vault-picture">
                                <img th:src="${vault.photoUrl != null and !#strings.isEmpty(vault.photoUrl) ? vault.photoUrl + '?t=' + vault.updatedAt : '/images/vault/vault_df.webp'}"
                                    alt="vault picture" style="object-fit: cover; width: 100%; height: 100%;">
                            </div>
                            <div class="vault-header-info" style="flex: 1; min-width: 0;">
                                <span class="vault-name" th:text="${vault.name}"
                                    style="text-decoration: none; color: #666;">Vault</span>
                                <div class="vault-owner"
                                    style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"
                                    th:title="${vault.createdByEmail}">
                                    Vault owner: <span th:text="${vault.createdByEmail}"
                                        style="white-space: nowrap;">Owner</span>
                                </div>
                            </div>

                            <!-- Meatball menu for trash vaults -->
                            <div class="vault-actions-menu" style="position: relative; z-index: 3;">
                                <button class="meatball-menu-btn" th:data-vault-id="${vault.id}"
                                    style="background: none; border: none; padding: 4px; cursor: pointer; border-radius: 4px;">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="12" cy="5" r="2" fill="#555555" />
                                        <circle cx="12" cy="12" r="2" fill="#555555" />
                                        <circle cx="12" cy="19" r="2" fill="#555555" />
                                    </svg>
                                </button>
                                <div th:id="'trash-menu-' + ${vault.id}" class="vault-menu-dropdown" style="display: none; position: absolute; top: 100%; right: 0; background: white; 
                                           border: 1px solid #e1e5e9; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                                           min-width: 150px; z-index: 1000;">
                                    <button class="vault-menu-item restore-item" th:data-vault-id="${vault.id}"
                                        th:data-vault-name="${vault.name}" style="width: 100%; padding: 12px 16px; border: none; background: none; 
                                               text-align: left; cursor: pointer; display: flex; align-items: center; gap: 8px;
                                               color: #28a745; font-size: 14px; border-radius: 6px 6px 0 0;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M4 12a8 8 0 018-8V2.5L14.5 5 12 7.5V6a6 6 0 100 12 6 6 0 006-6h2a8 8 0 01-16 0z"
                                                fill="currentColor" />
                                        </svg>
                                        Restore
                                    </button>
                                    <button class="vault-menu-item delete-item" th:data-vault-id="${vault.id}"
                                        th:data-vault-name="${vault.name}" style="width: 100%; padding: 12px 16px; border: none; background: none; 
                                               text-align: left; cursor: pointer; display: flex; align-items: center; gap: 8px;
                                               color: #dc3545; font-size: 14px; border-radius: 0 0 6px 6px;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                                                stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round" />
                                        </svg>
                                        Delete permanently
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-divider"></div>
                        <div class="card-vault-body">
                            <div class="vault-info">
                                <img src="/images/icon/Chart_pin_light.svg" alt="icon status">
                                <span>Status:</span>
                                <span class="status-deleted" style="color: #dc3545;">Deleted</span>
                            </div>
                            <div class="vault-info">
                                <img src="/images/icon/Group_duotone_line.svg" alt="icon members">
                                <span>Total members:</span>
                                <span class="number-in-card" th:text="${vaultMemberCounts[vault.id]}">0</span>
                            </div>
                            <div class="vault-info">
                                <img src="/images/icon/Chemistry _light.svg" alt="icon knowledge">
                                <span>Total knowledge articles:</span>
                                <span class="number-in-card" th:text="${vaultKnowledgeCounts[vault.id]}">0</span>
                            </div>
                        </div>
                        <div class="card-divider"></div>
                        <div class="create-date">
                            <img src="/images/icon/Time_duotone_line.svg" alt="icon knowledge">
                            <span>Deleted on</span>
                            <span
                                th:text="${vault.deletedAt == null ? '--' : #temporals.format(vault.deletedAt, 'dd/MMM/yy hh:mm a')}">--</span>
                        </div>
                    </div>
                </div>
                <div class="content-add-vault" th:classappend="${showAddVaultForm} ? '' : ' hidden'"
                    id="add-vault-form-content">
                    <div class="back-to-list">
                        <div class="back-to-list-icon" id="back-to-list-btn" title="Back">
                            <svg width="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg"
                                transform="rotate(0 0 0)">
                                <path
                                    d="M3.57813 12.4981C3.5777 12.6905 3.65086 12.8831 3.79761 13.0299L9.7936 19.0301C10.0864 19.3231 10.5613 19.3233 10.8543 19.0305C11.1473 18.7377 11.1474 18.2629 10.8546 17.9699L6.13418 13.2461L20.3295 13.2461C20.7437 13.2461 21.0795 12.9103 21.0795 12.4961C21.0795 12.0819 20.7437 11.7461 20.3295 11.7461L6.14168 11.7461L10.8546 7.03016C11.1474 6.73718 11.1473 6.2623 10.8543 5.9695C10.5613 5.6767 10.0864 5.67685 9.79362 5.96984L3.84392 11.9233C3.68134 12.0609 3.57812 12.2664 3.57812 12.4961L3.57813 12.4981Z"
                                    fill="#343C54" stroke-width="2" />
                            </svg>
                        </div>
                        <div class="back-to-list-text">Create Vault</div>
                    </div>
                    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
                    <div class="add-vault-form-container" style="gap: 80px; align-items: center;">
                        <div class="add-vault-form" style="flex: 1; min-width: 350px; max-width: 800px; margin: 0;">
                            <form id="add-vault-form" th:action="@{/vault-management/add-vault}"
                                th:object="${addVaultRequest}" method="post" enctype="multipart/form-data">

                                <div class="form-group">
                                    <label for="vaultPhoto">Vault Photo:</label>
                                    <div class="photo-upload-container"
                                        style="display: flex; align-items: center; gap: 15px;">
                                        <div class="photo-preview"
                                            style="width: 60px; height: 60px; border-radius: 8px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; overflow: hidden; background-color: #f8f9fa;">
                                            <img id="photoPreview" src="/images/vault/vault_df.webp" alt="Preview"
                                                style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;" />
                                        </div>
                                        <div style="flex: 1;">
                                            <input type="file" id="vaultPhoto" name="photo" accept="image/*"
                                                style="display: none;" onchange="previewVaultPhoto(this)">
                                            <div style="display: flex; gap: 8px; align-items: center;">
                                                <label for="vaultPhoto"
                                                    style=" margin-bottom: 0px; cursor: pointer; padding: 6px 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 12px; display: flex; align-items: center; gap: 5px;">
                                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path
                                                            d="M8 5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V8H6a.5.5 0 0 1 0-1h1.5V5.5A.5.5 0 0 1 8 5z" />
                                                        <path
                                                            d="M2 1a1 1 0 0 0-1 1v9.5a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 0-1H2V2h12v4.5a.5.5 0 0 0 1 0V2a1 1 0 0 0-1-1H2z" />
                                                    </svg>
                                                    Upload
                                                </label>
                                                <button type="button" onclick="removeVaultPhoto()"
                                                    style="padding: 6px 8px; background-color: #6c757d; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; display: flex; align-items: center;">
                                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path
                                                            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z" />
                                                        <path
                                                            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z" />
                                                    </svg>
                                                </button>
                                            </div>
                                            <div style="font-size: 11px; color: #666; margin-top: 8px;">
                                                Max 5MB • JPG, PNG, WebP
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="vaultName" class="required">Name:</label>
                                    <div class="input-vaultname-wrapper">
                                        <input type="text" id="vaultName" placeholder="Enter name" th:field="*{name}"
                                            th:classappend="${#fields.hasErrors('name')} ? 'input-error' : ''" required>
                                        <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}"
                                            style="margin-bottom: -15px; margin-top: 0px;" class="text-danger"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="vaultOwner" class="required">Vault Owner:</label>
                                    <input type="text" id="vaultOwner" style="background-color: #d5d5d533;"
                                        th:value="${user.email}" readonly>
                                    <input type="hidden" th:field="*{createdByUserId}" />
                                    <input type="hidden" th:field="*{createdByEmail}" />
                                </div>



                                <div class="form-group">
                                    <label for="description">Description:</label>
                                    <textarea id="description" name="description" rows="4" th:field="*{description}"
                                        placeholder="Enter description..." style="resize: vertical;"></textarea>
                                </div>
                                <div class="add-vault-btn-container" style="gap: 10px;">
                                    <button type="button" id="cancel-add-vault" class="modal-btn">
                                        Cancel
                                    </button>
                                    <button type="submit" class="modal-btn modal-form-btn">
                                        <svg viewBox="64 64 896 896" focusable="false" data-icon="save" width="1em"
                                            height="1em" fill="currentColor" aria-hidden="true">
                                            <path
                                                d="M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z">
                                            </path>
                                        </svg>
                                        <span>Save Vault</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div style="width: 400px; max-width: 100%;">
                            <img src="/images/background/add-vault-pic.png" alt=""
                                style="width: 100%; height: auto; border-radius: 8px;">
                        </div>
                    </div>


                </div>

            </div>
        </div>
    </div>

    <!-- Pop up settings -->

    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-profile-modal">
                <div role="button" tabindex="0"
                    style="user-select: none; transition: background 20ms ease-in; cursor: pointer; display: flex; align-items: center; height: 18px; padding: 0px; border-radius: 50%; white-space: nowrap; font-size: 14px; flex-shrink: 0; line-height: 1.2; min-width: 0px; color: rgb(50, 48, 44); margin-top: -5px; margin-right: -5px; width: 18px; background: rgba(84, 72, 49, 0.08); justify-content: center;">
                    <svg aria-hidden="true" role="graphics-symbol" viewBox="0 0 16 16" class="closeSmall"
                        style="width: 12px; height: 12px; display: block; fill: rgba(71, 70, 68, 0.6); flex-shrink: 0;">
                        <path
                            d="M3.732 11.052c-.303.308-.32.877.011 1.202.33.33.894.32 1.203.011L8 9.21l3.05 3.05c.32.325.872.32 1.197-.011a.857.857 0 00.01-1.197L9.21 8.002l3.05-3.056a.857.857 0 00-.01-1.197.857.857 0 00-1.198-.01L8 6.788 4.946 3.732c-.31-.303-.878-.32-1.203.01-.325.331-.314.895-.01 1.203l3.055 3.056-3.056 3.05z">
                        </path>
                    </svg>
                </div>
            </span>
            <div class="modal-body">
                <div class="modal-main" style="min-height: 120vh;">
                    <div id="tab-profile" class="tab-content">
                        <div class="label-section">Account Settings</div>
                        <div class="devider"></div>

                        <!-- Profile Photo Section -->
                        <div class="profile-photo-section">
                            <div class="profile-photo">
                                <div class="photo-placeholder">
                                    <img th:src="${user.avatar != null and !#strings.isEmpty(user.avatar) ? user.avatar : 'https://placehold.co/400x400'}"
                                        alt="Profile Avatar" id="profile-avatar-img">
                                </div>
                                <div class="photo-info">
                                    <span>Preferred name</span>
                                    <div class="input-wrapper">
                                        <input type="text" id="profile-username" th:value="${user.name}" />
                                    </div>
                                </div>
                            </div>
                            <div class="photo-upload-info">
                                <form id="avatar-upload-form" th:action="@{/vault-management/upload-avatar}"
                                    method="post" enctype="multipart/form-data" style="display: inline;">
                                    <input type="file" id="avatar-file-input" name="avatar"
                                        accept=".png,.jpg,.jpeg,.gif" style="display: none;" />
                                    <a class="link-add-photo" href="#"
                                        onclick="document.getElementById('avatar-file-input').click(); return false;">Add
                                        photo</a>
                                </form>
                                <span class="photo-format-info">We support PNGs, JPEGs and GIFs under 10MB</span>
                            </div>
                        </div>

                        <!-- Personal Information Section -->
                        <div class="label-section">Personal Information</div>
                        <div class="devider"></div>
                        <div class="personal-info-section">
                            <div class="profile-grid">
                                <!-- Department (read-only) -->
                                <div class="profile-field">
                                    <div class="label-field">Department</div>
                                    <div class="value-field"
                                        th:text="${user.department != null ? user.department : 'Not specified'}">Not
                                        specified</div>
                                </div>

                                <!-- Gender (editable) -->
                                <div class="profile-field">
                                    <div class="label-field">Gender</div>
                                    <select id="profile-gender">
                                        <option value="">Select gender</option>
                                        <option value="Male" th:selected="${user.gender == 'Male'}">Male</option>
                                        <option value="Female" th:selected="${user.gender == 'Female'}">Female</option>
                                        <option value="Other" th:selected="${user.gender == 'Other'}">Other</option>
                                    </select>
                                </div>

                                <!-- Phone Number (editable) -->
                                <div class="profile-field">
                                    <div class="label-field">Phone Number</div>
                                    <input type="tel" id="profile-phone" th:value="${user.phoneNumber}"
                                        placeholder="Enter phone number" />
                                </div>

                                <div class="profile-field">
                                    <div class="label-field">Date of Birth</div>
                                    <input type="date" id="profile-dob"
                                        th:value="${user.dateOfBirth != null ? user.dateOfBirth.toString() : ''}" />
                                </div>
                            </div>

                            <div class="save-button-container">
                                <button type="button" id="save-profile-btn" class="modal-btn modal-form-btn"
                                    style="border-radius: 40px !important;">
                                    Save Changes
                                </button>
                            </div>
                        </div>

                        <div class="label-section">Account Security</div>
                        <div class="devider"></div>
                        <div class="security-section">
                            <div class="account-security-field">
                                <div>
                                    <div class="label-field">Email</div>
                                    <div class="value-field" th:text="${user.email}">Email</div>
                                </div>
                            </div>
                            <div class="account-security-field">
                                <div>
                                    <div class="label-field">Password</div>
                                    <div th:if="${user.password == null}" class="value-field">Set a permanent
                                        password to login to your account.
                                    </div>
                                    <div th:if="${user.password != null}" class="value-field">Change your password
                                        to login to your account.
                                    </div>
                                </div>
                                <div th:if="${user.password != null and !#strings.isEmpty(user.password)}"
                                    class="modal-btn" id="changePassword" style="border-radius: 40px !important;">
                                    Change password
                                </div>
                                <div th:if="${user.password == null or #strings.isEmpty(user.password)}"
                                    class="modal-btn" id="addPassword" style="border-radius: 40px !important;">
                                    Add password
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pop up add-password-modal -->
    <div id="addPasswordModal" class="modal hidden">
        <div class="modal-add-password-content">
            <div style="display: flex; flex-direction: row; justify-content: flex-end; width: 100%;">
                <div role="button" tabindex="0"
                    style="user-select: none; transition: background 20ms ease-in; cursor: pointer; display: flex; align-items: center; height: 18px; padding: 0px; border-radius: 50%; white-space: nowrap; font-size: 14px; flex-shrink: 0; line-height: 1.2; min-width: 0px; color: rgb(50, 48, 44); margin-top: -5px; margin-right: -5px; width: 18px; background: rgba(84, 72, 49, 0.08); justify-content: center;">
                    <svg aria-hidden="true" role="graphics-symbol" viewBox="0 0 16 16" class="closeSmall"
                        style="width: 12px; height: 12px; display: block; fill: rgba(71, 70, 68, 0.6); flex-shrink: 0;">
                        <path
                            d="M3.732 11.052c-.303.308-.32.877.011 1.202.33.33.894.32 1.203.011L8 9.21l3.05 3.05c.32.325.872.32 1.197-.011a.857.857 0 00.01-1.197L9.21 8.002l3.05-3.056a.857.857 0 00-.01-1.197.857.857 0 00-1.198-.01L8 6.788 4.946 3.732c-.31-.303-.878-.32-1.203.01-.325.331-.314.895-.01 1.203l3.055 3.056-3.056 3.05z">
                        </path>
                    </svg>
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <svg aria-hidden="true" role="graphics-symbol" viewBox="0 0 31 21" class="setPassword"
                    style="width: 27px; height: 27px; display: block; fill: rgb(50, 48, 44); flex-shrink: 0;">
                    <path
                        d="M29.4746 3.43945L30.1777 2.7168C30.5684 2.32617 30.5781 1.7793 30.1973 1.39844L29.9336 1.14453C29.6016 0.802734 29.0352 0.851562 28.6641 1.22266L27.9609 1.91602L29.4746 3.43945ZM18.2441 13.4883L20.3047 12.5996L28.7227 4.18164L27.209 2.6875L18.8008 11.0957L17.8633 13.0977C17.7656 13.3223 18.0195 13.5859 18.2441 13.4883ZM3.40039 20.0508H23.6543C25.5 20.0508 26.5254 19.0547 26.5254 17.2188V8.88867L24.5918 10.8223V17.0625C24.5918 17.8242 24.1621 18.2637 23.3906 18.2637H3.6543C2.88281 18.2637 2.45312 17.8242 2.45312 17.0625V8.91797C2.45312 8.14648 2.88281 7.7168 3.6543 7.7168H19.6504L21.4375 5.93945H3.40039C1.54492 5.93945 0.519531 6.92578 0.519531 8.77148V17.2188C0.519531 19.0547 1.54492 20.0508 3.40039 20.0508ZM6.06641 14.4453C6.85742 14.4453 7.51172 13.791 7.51172 12.9902C7.51172 12.1895 6.85742 11.5449 6.06641 11.5449C5.25586 11.5449 4.61133 12.1895 4.61133 12.9902C4.61133 13.791 5.25586 14.4453 6.06641 14.4453ZM10.373 14.4453C11.1738 14.4453 11.8184 13.791 11.8184 12.9902C11.8184 12.1895 11.1738 11.5449 10.373 11.5449C9.57227 11.5449 8.91797 12.1895 8.91797 12.9902C8.91797 13.791 9.57227 14.4453 10.373 14.4453ZM14.6797 14.4453C15.4805 14.4453 16.1348 13.791 16.1348 12.9902C16.1348 12.1895 15.4805 11.5449 14.6797 11.5449C13.8789 11.5449 13.2344 12.1895 13.2344 12.9902C13.2344 13.791 13.8789 14.4453 14.6797 14.4453Z">
                    </path>
                </svg>
            </div>
            <div style="margin: 10px 0px; text-align: center;">
                <div class="tx-uiregular-14-semi" color="primary">Set a password</div>
            </div>
            <div class="msg">
                Use a password at least 15 letters long, or at least 8 characters long with both letters and numbers.
            </div>
            <form th:action="@{/auth/add-password}" method="post" th:object="${addPasswordRequest}"
                id="add-password-form">
                <div style="margin-top: 10px;">
                    <label class="input-label">Enter a new password</label>
                    <div class="input-wrapper">
                        <input class="input-field" placeholder="Enter new password" autocomplete="new-password"
                            type="password" th:field="*{newPassword}" required>
                    </div>
                </div>
                <div style="margin-top: 10px;">
                    <label class="input-label">Confirm your new password</label>
                    <div class="input-wrapper">
                        <input class="input-field" placeholder="Confirm new password" autocomplete="new-password"
                            type="password" th:field="*{confirmNewPassword}" required>
                    </div>
                </div>
                <button type="submit" class="modal-btn modal-form-btn" style="width: auto; margin-top: 15px;">
                    Set a password
                </button>
            </form>
        </div>
    </div>

    <!-- Pop up change-password-modal -->
    <div id="changePasswordModal" class="modal hidden">
        <div class="modal-add-password-content">
            <div style="display: flex; flex-direction: row; justify-content: flex-end; width: 100%;">
                <div role="button" tabindex="0"
                    style="user-select: none; transition: background 20ms ease-in; cursor: pointer; display: flex; align-items: center; height: 18px; padding: 0px; border-radius: 50%; white-space: nowrap; font-size: 14px; flex-shrink: 0; line-height: 1.2; min-width: 0px; color: rgb(50, 48, 44); margin-top: -5px; margin-right: -5px; width: 18px; background: rgba(84, 72, 49, 0.08); justify-content: center;">
                    <svg aria-hidden="true" role="graphics-symbol" viewBox="0 0 16 16" class="closeSmall"
                        style="width: 12px; height: 12px; display: block; fill: rgba(71, 70, 68, 0.6); flex-shrink: 0;">
                        <path
                            d="M3.732 11.052c-.303.308-.32.877.011 1.202.33.33.894.32 1.203.011L8 9.21l3.05 3.05c.32.325.872.32 1.197-.011a.857.857 0 00.01-1.197L9.21 8.002l3.05-3.056a.857.857 0 00-.01-1.197.857.857 0 00-1.198-.01L8 6.788 4.946 3.732c-.31-.303-.878-.32-1.203.01-.325.331-.314.895-.01 1.203l3.055 3.056-3.056 3.05z">
                        </path>
                    </svg>
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <svg aria-hidden="true" role="graphics-symbol" viewBox="0 0 31 21" class="setPassword"
                    style="width: 27px; height: 27px; display: block; fill: rgb(50, 48, 44); flex-shrink: 0;">
                    <path
                        d="M29.4746 3.43945L30.1777 2.7168C30.5684 2.32617 30.5781 1.7793 30.1973 1.39844L29.9336 1.14453C29.6016 0.802734 29.0352 0.851562 28.6641 1.22266L27.9609 1.91602L29.4746 3.43945ZM18.2441 13.4883L20.3047 12.5996L28.7227 4.18164L27.209 2.6875L18.8008 11.0957L17.8633 13.0977C17.7656 13.3223 18.0195 13.5859 18.2441 13.4883ZM3.40039 20.0508H23.6543C25.5 20.0508 26.5254 19.0547 26.5254 17.2188V8.88867L24.5918 10.8223V17.0625C24.5918 17.8242 24.1621 18.2637 23.3906 18.2637H3.6543C2.88281 18.2637 2.45312 17.8242 2.45312 17.0625V8.91797C2.45312 8.14648 2.88281 7.7168 3.6543 7.7168H19.6504L21.4375 5.93945H3.40039C1.54492 5.93945 0.519531 6.92578 0.519531 8.77148V17.2188C0.519531 19.0547 1.54492 20.0508 3.40039 20.0508ZM6.06641 14.4453C6.85742 14.4453 7.51172 13.791 7.51172 12.9902C7.51172 12.1895 6.85742 11.5449 6.06641 11.5449C5.25586 11.5449 4.61133 12.1895 4.61133 12.9902C4.61133 13.791 5.25586 14.4453 6.06641 14.4453ZM10.373 14.4453C11.1738 14.4453 11.8184 13.791 11.8184 12.9902C11.8184 12.1895 11.1738 11.5449 10.373 11.5449C9.57227 11.5449 8.91797 12.1895 8.91797 12.9902C8.91797 13.791 9.57227 14.4453 10.373 14.4453ZM14.6797 14.4453C15.4805 14.4453 16.1348 13.791 16.1348 12.9902C16.1348 12.1895 15.4805 11.5449 14.6797 11.5449C13.8789 11.5449 13.2344 12.1895 13.2344 12.9902C13.2344 13.791 13.8789 14.4453 14.6797 14.4453Z">
                    </path>
                </svg>
            </div>
            <div style="margin: 10px 0px; text-align: center;">
                <div class="tx-uiregular-14-semi" color="primary">Change password</div>
            </div>
            <div class="msg">
                Use a password at least 15 letters long, or at least 8 characters long with both letters and numbers.
            </div>
            <form th:action="@{/auth/change-password}" method="post" th:object="${changePasswordRequest}"
                id="change-password-form">
                <div style="margin-top: 10px;">
                    <label class="input-label">Enter your current password</label>
                    <div class="input-wrapper">
                        <input class="input-field" placeholder="Current password" autocomplete="new-password"
                            type="password" th:field="*{currentPassword}" required>
                    </div>
                    <div th:if="${#fields.hasErrors('currentPassword')}" th:errors="*{currentPassword}"
                        class="error-msg"></div>

                </div>
                <div style="margin-top: 10px;">
                    <label class="input-label">Enter a new password</label>
                    <div class="input-wrapper">
                        <input class="input-field" placeholder="Enter new password" autocomplete="new-password"
                            type="password" th:field="*{newPassword}" required>
                    </div>
                    <div th:if="${#fields.hasErrors('newPassword')}" th:errors="*{newPassword}" class="error-msg"></div>

                </div>
                <div style="margin-top: 10px;">
                    <label class="input-label">Confirm your new password</label>
                    <div class="input-wrapper">
                        <input class="input-field" placeholder="Confirm new password" autocomplete="new-password"
                            type="password" th:field="*{confirmNewPassword}" required>
                    </div>
                    <div th:if="${#fields.hasErrors('confirmNewPassword')}" th:errors="*{confirmNewPassword}"
                        class="error-msg"></div>
                </div>
                <button class="modal-btn modal-form-btn" type="submit" style="width: 100%; margin-top: 15px;">
                    Change password
                </button>
            </form>
        </div>
    </div>

    <!-- Pop up delete account -->
    <div id="deleteAccountModal" class="modal hidden">
        <div class="delete-account-content">
            <svg aria-hidden="true" role="graphics-symbol" viewBox="0 0 20 20" class="exclamationMarkCircle">
                <path
                    d="M9.875 6.25c.345 0 .625.28.625.625v3.5a.625.625 0 1 1-1.25 0v-3.5c0-.345.28-.625.625-.625m0 7.375a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5">
                </path>
                <path
                    d="M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75">
                </path>
            </svg>
            <div class="delete-account-text">
                Deactivate your account?
            </div>
            <p class="msg">
                Your account will be temporarily deactivated. You won't be able to access your private workspaces, and
                you'll be removed from all shared workspaces until you reactivate your account. You can reactivate
                anytime
                by signing in again.
            </p>
            <div class="vault-container">
                <ul class="vault-list">
                    <div class="vault-item-wrapper">
                        <div class="vault-item">
                            <div class="vault-icon">
                                <div class="vault-icon-letter" role="img" aria-label="H">
                                    <div class="vault-letter">H</div>
                                </div>
                            </div>
                            <div class="vault-info">
                                <div class="vault-title">Huy Đặng’s Vault</div>
                                <div class="vault-members">1 member</div>
                            </div>
                        </div>
                    </div>
                </ul>
            </div>
            <div style="margin-top: 10px; font-size: 14px; color: rgb(50, 48, 44); align-self: flex-start;">
                Please type in your email to confirm.
            </div>
            <div class="input-container">
                <input type="text" th:placeholder="${user.email}" class="custom-input"
                    id="delete-account-email-input" />
            </div>
            <div role="button" class="modal-btn modal-delete-btn" id="delete-account-confirm-btn"
                style="width: 100%; margin-top: 15px;"
                th:text="'Temporarily deactivate account and ' + ${totalVaults} + ' vault' + (${totalVaults} != 1 ? 's' : '')">
                Temporarily deactivate account and vaults
            </div>
            <div role="button" tabindex="0" class="button-cancel">
                Cancel
            </div>
        </div>
    </div>

    <div id="toast-notification" class="toast-notification">
        <svg xmlns="http://www.w3.org/2000/svg" style="width: 18px; height: 18px; margin-right: 10px;" fill="none"
            viewBox="0 0 24 24" stroke="#065f46" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
        </svg>
        <span style="flex-grow: 1;" id="toast-message"></span>
    </div>


    <th:block th:if="${successAddVaultMessage != null}">
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(function () {
                    showToast('[[${successAddVaultMessage}]]');
                    const vaultImages = document.querySelectorAll('.vault-picture img');
                    vaultImages.forEach(function (img) {
                        const src = img.src;
                        if (src.includes('/images/vault/')) {
                            img.src = src.split('?')[0] + '?t=' + new Date().getTime();
                        }
                    });
                }, 2000);
            });
        </script>
    </th:block>
    <th:block th:if="${successDeleteVaultMessage != null}">
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(function () {
                    showToast('[[${successDeleteVaultMessage}]]');
                }, 2000);
            });
        </script>
    </th:block>

    <th:block th:if="${successLeaveVaultMessage != null}">
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(function () {
                    showToast('[[${successLeaveVaultMessage}]]');
                }, 2000);
            });
        </script>
    </th:block>

    <th:block th:if="${successMessage != null}">
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(function () {
                    showToast('[[${successMessage}]]', 'success');
                }, 1000);
            });
        </script>
    </th:block>

    <th:block th:if="${errorMessage != null}">
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(function () {
                    showToast('[[${errorMessage}]]', 'error');
                }, 1000);
            });
        </script>
    </th:block>

    <script>
        function previewVaultPhoto(input) {
            const preview = document.getElementById('photoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function removeVaultPhoto() {
            const input = document.getElementById('vaultPhoto');
            const preview = document.getElementById('photoPreview');
            input.value = '';
            preview.src = '/images/vault/vault_df.webp';
        }
    </script>

    <!-- Restore Vault Confirm Modal -->
    <div id="restoreVaultModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 12a8 8 0 018-8V2.5L14.5 5 12 7.5V6a6 6 0 100 12 6 6 0 006-6h2a8 8 0 01-16 0z"
                        fill="#28a745" />
                </svg>
            </div>
            <div class="confirm-modal-title">Restore Vault</div>
            <div class="confirm-modal-message">
                Are you sure you want to restore the vault "<span id="restoreVaultName"
                    class="confirm-modal-vault-name"></span>"?
                This will make it active and accessible again.
            </div>
            <div class="confirm-modal-buttons">
                <button class="confirm-modal-btn cancel" onclick="hideRestoreConfirm()">Cancel</button>
                <button class="confirm-modal-btn restore" onclick="confirmRestore()">Restore</button>
            </div>
        </div>
    </div>

    <!-- Delete Vault Permanently Confirm Modal -->
    <div id="deleteNowVaultModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                        stroke="#dc3545" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M10 11v6M14 11v6" stroke="#dc3545" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
            <div class="confirm-modal-title">Delete Vault Permanently</div>
            <div class="confirm-modal-message">
                Are you sure you want to permanently delete the vault "<span id="deleteNowVaultName"
                    class="confirm-modal-vault-name"></span>"?
                <strong>This action cannot be undone</strong> and all data will be lost forever.
            </div>
            <div class="confirm-modal-buttons">
                <button class="confirm-modal-btn cancel" onclick="hideDeleteNowConfirm()">Cancel</button>
                <button class="confirm-modal-btn delete" onclick="confirmDeleteNow()">Delete Permanently</button>
            </div>
        </div>
    </div>

</body>
<script src="/js/vault_management.js"></script>
<script src="/js/loader.js"></script>

</html>